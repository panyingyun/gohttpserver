version: '3.8'

services:
  gohttpserver:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: gohttpserver
    restart: unless-stopped
    ports:
      - "8080:8080"   # HTTP
      - "8443:8443"   # HTTPS
    volumes:
      # Mount data directory for file storage
      - ./data:/data
      # Optional: Mount certificates for HTTPS
      - ./certs:/certs:ro
    environment:
      - ROOT_DIR=/data
      - PORT=8080
      - HTTPS_PORT=8443
    # Command line arguments (override CMD if needed)
    # Uncomment and modify as needed:
    # command: ["./gohttpserver", "--root", "/data", "--port", "8080", "--web-dir", "./web", "--webdav"]
    
    # For HTTPS, uncomment and provide cert/key:
    # command: ["./gohttpserver", "--root", "/data", "--port", "8080", "--https", "--https-port", "8443", "--cert", "/certs/cert.pem", "--key", "/certs/key.pem", "--web-dir", "./web"]
    
    # For authentication, add:
    # command: ["./gohttpserver", "--root", "/data", "--port", "8080", "--auth", "admin:password", "--web-dir", "./web"]
    
    # For path access control:
    # command: ["./gohttpserver", "--root", "/data", "--port", "8080", "--allow-paths", "/public,/shared", "--deny-paths", "/private", "--web-dir", "./web"]
    
    networks:
      - gohttpserver-network
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:8080/api/list"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

networks:
  gohttpserver-network:
    driver: bridge

volumes:
  # Optional: Use named volume instead of bind mount
  # data:
  #   driver: local
